{"ast":null,"code":"/* CONFIGS */\nimport appConfig from '../appConfig.json';\n/* CLASSES */\n\nimport Player from '../classes/Player';\n/* MODELS */\n\nimport Errors from '../models/Errors';\n/* CONTROLLERS */\n\nimport { getCurrentPlayerInstance } from './PlayerManager';\n/* GLOBALS */\n\nvar isLsEnabled;\nvar savingRequestLock;\n/**\n * Check if localStorage is Enabled\n * @returns {boolean}\n */\n\nvar checkIfLocalStorageIsEnabled = function checkIfLocalStorageIsEnabled() {\n  var test = 'TEST';\n\n  try {\n    window.localStorage.setItem(test, test);\n    window.localStorage.removeItem(test);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n/**\n * Save player progress inside localstorage\n * @returns {Promise<boolean>}\n */\n\n\nvar savePlayerToLocalStorage = function savePlayerToLocalStorage() {\n  // is localstorage enabled? if false throw an error\n  if (isLsEnabled !== true && !checkIfLocalStorageIsEnabled()) throw Errors.LOCAL_STORAGE_NOT_SUPPORTED;\n  isLsEnabled = true; // save the player object inside the localStorage\n\n  if (!savingRequestLock) {\n    savingRequestLock = true;\n    setTimeout(function () {\n      var currentPlayerInstance = getCurrentPlayerInstance();\n      window.localStorage.setItem(appConfig.LOCAL_STORAGE_KEYS.PLAYER, btoa(currentPlayerInstance[\"export\"]()));\n      savingRequestLock = false;\n    }, appConfig.PLAYER_CONFIG.MAX_FREQUENCY_SECONDS_DELTA_FOR_LS_SAVING * 1000);\n  }\n\n  return {\n    success: true\n  };\n};\n/**\n * Retrieve player from localStorage\n * @returns {Player}\n */\n\n\nvar retrievePlayerFromLocalStorage = function retrievePlayerFromLocalStorage() {\n  // is localstorage enabled? if false throw an error\n  if (isLsEnabled !== true && !checkIfLocalStorageIsEnabled()) throw Errors.LOCAL_STORAGE_NOT_SUPPORTED; // save the player object inside the localStorage\n\n  var playerRawDataFromLS = window.localStorage.getItem(appConfig.LOCAL_STORAGE_KEYS.PLAYER);\n  if (playerRawDataFromLS === null) throw Errors.PLAYER_NOT_FOUND_IN_LOCAL_STORAGE; // check if player retrieved has a valid object structure\n\n  try {\n    var _JSON$parse = JSON.parse(atob(playerRawDataFromLS)),\n        id = _JSON$parse.id,\n        name = _JSON$parse.name,\n        money = _JSON$parse.money,\n        businesses = _JSON$parse.businesses;\n\n    if (typeof id !== \"string\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    if (typeof name !== \"string\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    if (typeof money !== \"number\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    if (typeof businesses !== \"object\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    return new Player(id, name, money, businesses, Date.now());\n  } catch (e) {\n    throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n  }\n};\n\nexport { checkIfLocalStorageIsEnabled, savePlayerToLocalStorage, retrievePlayerFromLocalStorage };","map":{"version":3,"sources":["/Users/pierfrancescodorsogna/Documents/PROJECTS/adventure-cap_italy_st/controllers/StorageManager.js"],"names":["appConfig","Player","Errors","getCurrentPlayerInstance","isLsEnabled","savingRequestLock","checkIfLocalStorageIsEnabled","test","window","localStorage","setItem","removeItem","e","savePlayerToLocalStorage","LOCAL_STORAGE_NOT_SUPPORTED","setTimeout","currentPlayerInstance","LOCAL_STORAGE_KEYS","PLAYER","btoa","PLAYER_CONFIG","MAX_FREQUENCY_SECONDS_DELTA_FOR_LS_SAVING","success","retrievePlayerFromLocalStorage","playerRawDataFromLS","getItem","PLAYER_NOT_FOUND_IN_LOCAL_STORAGE","JSON","parse","atob","id","name","money","businesses","GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE","Date","now"],"mappings":"AAAA;AACA,OAAOA,SAAP,MAAsB,mBAAtB;AACA;;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA;;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AACA;;AACA,SAASC,wBAAT,QAAyC,iBAAzC;AAEA;;AACA,IAAIC,WAAJ;AACA,IAAIC,iBAAJ;AAEA;AACA;AACA;AACA;;AACA,IAAMC,4BAA4B,GAAG,SAA/BA,4BAA+B,GAAM;AACzC,MAAMC,IAAI,GAAG,MAAb;;AACA,MAAI;AACFC,IAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4BH,IAA5B,EAAkCA,IAAlC;AACAC,IAAAA,MAAM,CAACC,YAAP,CAAoBE,UAApB,CAA+BJ,IAA/B;AACA,WAAO,IAAP;AACD,GAJD,CAIE,OAAOK,CAAP,EAAU;AACV,WAAO,KAAP;AACD;AACF,CATD;AAWA;AACA;AACA;AACA;;;AACA,IAAMC,wBAAwB,GAAG,SAA3BA,wBAA2B,GAAM;AAErC;AACA,MAAIT,WAAW,KAAK,IAAhB,IAAwB,CAACE,4BAA4B,EAAzD,EAA6D,MAAMJ,MAAM,CAACY,2BAAb;AAC7DV,EAAAA,WAAW,GAAG,IAAd,CAJqC,CAMrC;;AACA,MAAI,CAACC,iBAAL,EAAwB;AACtBA,IAAAA,iBAAiB,GAAG,IAApB;AACAU,IAAAA,UAAU,CAAC,YAAM;AACf,UAAIC,qBAAqB,GAAGb,wBAAwB,EAApD;AACAK,MAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4BV,SAAS,CAACiB,kBAAV,CAA6BC,MAAzD,EAAiEC,IAAI,CAACH,qBAAqB,UAArB,EAAD,CAArE;AACAX,MAAAA,iBAAiB,GAAG,KAApB;AACD,KAJS,EAIPL,SAAS,CAACoB,aAAV,CAAwBC,yCAAxB,GAAoE,IAJ7D,CAAV;AAKD;;AAED,SAAO;AACLC,IAAAA,OAAO,EAAE;AADJ,GAAP;AAGD,CAnBD;AAqBA;AACA;AACA;AACA;;;AACA,IAAMC,8BAA8B,GAAG,SAAjCA,8BAAiC,GAAM;AAE3C;AACA,MAAInB,WAAW,KAAK,IAAhB,IAAwB,CAACE,4BAA4B,EAAzD,EAA6D,MAAMJ,MAAM,CAACY,2BAAb,CAHlB,CAK3C;;AACA,MAAMU,mBAAmB,GAAGhB,MAAM,CAACC,YAAP,CAAoBgB,OAApB,CAA4BzB,SAAS,CAACiB,kBAAV,CAA6BC,MAAzD,CAA5B;AACA,MAAIM,mBAAmB,KAAK,IAA5B,EAAkC,MAAMtB,MAAM,CAACwB,iCAAb,CAPS,CAS3C;;AACA,MAAI;AAAA,sBACoCC,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACL,mBAAD,CAAf,CADpC;AAAA,QACKM,EADL,eACKA,EADL;AAAA,QACSC,IADT,eACSA,IADT;AAAA,QACeC,KADf,eACeA,KADf;AAAA,QACsBC,UADtB,eACsBA,UADtB;;AAGF,QAAI,OAAOH,EAAP,KAAc,QAAlB,EAA4B,MAAM5B,MAAM,CAACgC,uDAAb;AAC5B,QAAI,OAAOH,IAAP,KAAgB,QAApB,EAA8B,MAAM7B,MAAM,CAACgC,uDAAb;AAC9B,QAAI,OAAOF,KAAP,KAAiB,QAArB,EAA+B,MAAM9B,MAAM,CAACgC,uDAAb;AAC/B,QAAI,OAAOD,UAAP,KAAsB,QAA1B,EAAoC,MAAM/B,MAAM,CAACgC,uDAAb;AAEpC,WAAO,IAAIjC,MAAJ,CAAW6B,EAAX,EAAeC,IAAf,EAAqBC,KAArB,EAA4BC,UAA5B,EAAwCE,IAAI,CAACC,GAAL,EAAxC,CAAP;AAED,GAVD,CAUE,OAAOxB,CAAP,EAAU;AACV,UAAMV,MAAM,CAACgC,uDAAb;AACD;AACF,CAvBD;;AAyBA,SACE5B,4BADF,EAEEO,wBAFF,EAGEU,8BAHF","sourcesContent":["/* CONFIGS */\nimport appConfig from '../appConfig.json'\n/* CLASSES */\nimport Player from '../classes/Player'\n/* MODELS */\nimport Errors from '../models/Errors'\n/* CONTROLLERS */\nimport { getCurrentPlayerInstance } from './PlayerManager';\n\n/* GLOBALS */\nlet isLsEnabled;\nlet savingRequestLock;\n\n/**\n * Check if localStorage is Enabled\n * @returns {boolean}\n */\nconst checkIfLocalStorageIsEnabled = () => {\n  const test = 'TEST';\n  try {\n    window.localStorage.setItem(test, test);\n    window.localStorage.removeItem(test);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n\n/**\n * Save player progress inside localstorage\n * @returns {Promise<boolean>}\n */\nconst savePlayerToLocalStorage = () => {\n\n  // is localstorage enabled? if false throw an error\n  if (isLsEnabled !== true && !checkIfLocalStorageIsEnabled()) throw Errors.LOCAL_STORAGE_NOT_SUPPORTED;\n  isLsEnabled = true;\n\n  // save the player object inside the localStorage\n  if (!savingRequestLock) {\n    savingRequestLock = true;\n    setTimeout(() => {\n      let currentPlayerInstance = getCurrentPlayerInstance();\n      window.localStorage.setItem(appConfig.LOCAL_STORAGE_KEYS.PLAYER, btoa(currentPlayerInstance.export()));\n      savingRequestLock = false;\n    }, appConfig.PLAYER_CONFIG.MAX_FREQUENCY_SECONDS_DELTA_FOR_LS_SAVING * 1000)\n  }\n\n  return {\n    success: true\n  };\n}\n\n/**\n * Retrieve player from localStorage\n * @returns {Player}\n */\nconst retrievePlayerFromLocalStorage = () => {\n\n  // is localstorage enabled? if false throw an error\n  if (isLsEnabled !== true && !checkIfLocalStorageIsEnabled()) throw Errors.LOCAL_STORAGE_NOT_SUPPORTED\n\n  // save the player object inside the localStorage\n  const playerRawDataFromLS = window.localStorage.getItem(appConfig.LOCAL_STORAGE_KEYS.PLAYER);\n  if (playerRawDataFromLS === null) throw Errors.PLAYER_NOT_FOUND_IN_LOCAL_STORAGE;\n\n  // check if player retrieved has a valid object structure\n  try {\n    const {id, name, money, businesses} = JSON.parse(atob(playerRawDataFromLS));\n\n    if (typeof id !== \"string\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    if (typeof name !== \"string\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    if (typeof money !== \"number\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n    if (typeof businesses !== \"object\") throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n\n    return new Player(id, name, money, businesses, Date.now());\n\n  } catch (e) {\n    throw Errors.GENERIC_ERROR_WHILE_RETRIVING_PLAYER_FROM_LOCAL_STORAGE;\n  }\n}\n\nexport {\n  checkIfLocalStorageIsEnabled,\n  savePlayerToLocalStorage,\n  retrievePlayerFromLocalStorage\n}\n"]},"metadata":{},"sourceType":"module"}